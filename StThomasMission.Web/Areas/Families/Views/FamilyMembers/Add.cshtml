@using StThomasMission.Core.Enums
@model StThomasMission.Web.Areas.Families.Models.FamilyMemberViewModel

@{
    ViewData["Title"] = "Add Family Member";
}

<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h3 class="mb-0"><i class="fas fa-user-plus me-2"></i>Add Family Member to @ViewData["FamilyName"]</h3>
        </div>
        <div class="card-body">
            <form asp-action="Add" asp-area="Families" method="post" id="addFamilyMemberForm">
                <input type="hidden" asp-for="FamilyId" />
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                <div class="row">
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="FirstName" class="form-label fw-bold"></label>
                        <input asp-for="FirstName" class="form-control" placeholder="Enter first name" required />
                        <span asp-validation-for="FirstName" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="LastName" class="form-label fw-bold"></label>
                        <input asp-for="LastName" class="form-control" placeholder="Enter last name" required />
                        <span asp-validation-for="LastName" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="BaptismalName" class="form-label fw-bold">Baptismal Name (Optional)</label>
                        <input asp-for="BaptismalName" class="form-control" placeholder="Enter baptismal name" />
                        <span asp-validation-for="BaptismalName" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="Relation" class="form-label fw-bold"></label>
                        <select asp-for="Relation" class="form-select" asp-items="Html.GetEnumSelectList<StThomasMission.Core.Enums.FamilyMemberRole>()" required>
                            <option value="">Select Relation</option>
                        </select>
                        <span asp-validation-for="Relation" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="DateOfBirth" class="form-label fw-bold"></label>
                        <input asp-for="DateOfBirth" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                        <span asp-validation-for="DateOfBirth" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="DateOfBaptism" class="form-label fw-bold">Date of Baptism (Optional)</label>
                        <input asp-for="DateOfBaptism" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                        <span asp-validation-for="DateOfBaptism" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="DateOfChrismation" class="form-label fw-bold">Date of Chrismation (Optional)</label>
                        <input asp-for="DateOfChrismation" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                        <span asp-validation-for="DateOfChrismation" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="DateOfHolyCommunion" class="form-label fw-bold">Date of Holy Communion (Optional)</label>
                        <input asp-for="DateOfHolyCommunion" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                        <span asp-validation-for="DateOfHolyCommunion" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="DateOfMarriage" class="form-label fw-bold">Date of Marriage (Optional)</label>
                        <input asp-for="DateOfMarriage" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                        <span asp-validation-for="DateOfMarriage" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="DateOfDeath" class="form-label fw-bold">Date of Death (Optional)</label>
                        <input asp-for="DateOfDeath" type="date" class="form-control" max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                        <span asp-validation-for="DateOfDeath" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="Contact" class="form-label fw-bold">Contact (Optional)</label>
                        <input asp-for="Contact" class="form-control" placeholder="e.g., +1234567890" />
                        <span asp-validation-for="Contact" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="Email" class="form-label fw-bold">Email (Optional)</label>
                        <input asp-for="Email" type="email" class="form-control" placeholder="e.g., example@example.com" />
                        <span asp-validation-for="Email" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="Role" class="form-label fw-bold">Role (Optional)</label>
                        <input asp-for="Role" class="form-control" placeholder="e.g., Parent, Child" />
                        <span asp-validation-for="Role" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="CreatedBy" class="form-label fw-bold">Created By</label>
                        <input asp-for="CreatedBy" class="form-control" placeholder="Enter creator" required />
                        <span asp-validation-for="CreatedBy" class="text-danger"></span>
                    </div>
                    <div class="col-12 col-md-6 mb-3">
                        <label asp-for="UpdatedBy" class="form-label fw-bold">Updated By (Optional)</label>
                        <input asp-for="UpdatedBy" class="form-control" placeholder="Enter updater" />
                        <span asp-validation-for="UpdatedBy" class="text-danger"></span>
                    </div>
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <a asp-controller="Families" asp-action="Details" asp-route-id="@Model.FamilyId" asp-area="Families" class="btn btn-secondary me-2"><i class="fas fa-times me-2"></i>Cancel</a>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-save me-2"></i>Add Member</button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="addFamilyMemberToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">Family Member Status</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body"></div>
    </div>
</div>

@section Scripts {
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validation-unobtrusive/4.0.0/jquery.validate.unobtrusive.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#addFamilyMemberForm").validate({
                rules: {
                    FirstName: {
                        required: true,
                        maxlength: 100
                    },
                    LastName: {
                        required: true,
                        maxlength: 100
                    },
                    BaptismalName: {
                        maxlength: 100
                    },
                    Relation: {
                        required: true
                    },
                    DateOfBirth: {
                        required: true,
                        date: true
                    },
                    DateOfBaptism: {
                        date: true
                    },
                    DateOfChrismation: {
                        date: true
                    },
                    DateOfHolyCommunion: {
                        date: true
                    },
                    DateOfMarriage: {
                        date: true
                    },
                    DateOfDeath: {
                        date: true
                    },
                    Contact: {
                        maxlength: 20,
                        pattern: /^\+?\d{10,15}$/
                    },
                    Email: {
                        email: true,
                        maxlength: 150
                    },
                    Role: {
                        maxlength: 50
                    },
                    CreatedBy: {
                        required: true,
                        maxlength: 100
                    },
                    UpdatedBy: {
                        maxlength: 100
                    }
                },
                messages: {
                    FirstName: {
                        required: "Please enter a first name.",
                        maxlength: "First name cannot exceed 100 characters."
                    },
                    LastName: {
                        required: "Please enter a last name.",
                        maxlength: "Last name cannot exceed 100 characters."
                    },
                    BaptismalName: {
                        maxlength: "Baptismal name cannot exceed 100 characters."
                    },
                    Relation: {
                        required: "Please select a relation."
                    },
                    DateOfBirth: {
                        required: "Please select a date of birth.",
                        date: "Please enter a valid date."
                    },
                    DateOfBaptism: {
                        date: "Please enter a valid date."
                    },
                    DateOfChrismation: {
                        date: "Please enter a valid date."
                    },
                    DateOfHolyCommunion: {
                        date: "Please enter a valid date."
                    },
                    DateOfMarriage: {
                        date: "Please enter a valid date."
                    },
                    DateOfDeath: {
                        date: "Please enter a valid date."
                    },
                    Contact: {
                        maxlength: "Contact number cannot exceed 20 characters.",
                        pattern: "Invalid phone number format."
                    },
                    Email: {
                        email: "Please enter a valid email address.",
                        maxlength: "Email cannot exceed 150 characters."
                    },
                    Role: {
                        maxlength: "Role cannot exceed 50 characters."
                    },
                    CreatedBy: {
                        required: "Please enter the creator.",
                        maxlength: "Created by cannot exceed 100 characters."
                    },
                    UpdatedBy: {
                        maxlength: "Updated by cannot exceed 100 characters."
                    }
                },
                errorElement: "div",
                errorClass: "text-danger",
                highlight: function (element) {
                    $(element).addClass("is-invalid");
                },
                unhighlight: function (element) {
                    $(element).removeClass("is-invalid");
                }
            });

            $("#addFamilyMemberForm").on("submit", function () {
                var $submitButton = $(this).find('button[type="submit"]');
                if ($(this).valid()) {
                    $submitButton.prop("disabled", true).prepend('<span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>');
                }
            });
        });
    </script>
}