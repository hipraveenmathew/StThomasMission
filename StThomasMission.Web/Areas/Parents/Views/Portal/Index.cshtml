@model StThomasMission.Web.Areas.Parents.Models.ParentPortalViewModel

@{
    ViewData["Title"] = "Parent Portal";
}

<h1>Parent Portal</h1>

<h3>Family: @Model.Family.FamilyName</h3>
<p>Ward: @Model.Family.Ward.Name</p>
<p>Status: @Model.Family.Status</p>
@if (Model.Family.Status == StThomasMission.Core.Enums.FamilyStatus.Migrated)
{
    <p>Migrated To: @Model.Family.MigratedTo</p>
}

<h4>Students</h4>
@if (Model.Students.Any())
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Grade</th>
                <th>Academic Year</th>
                <th>Status</th>
                <th>Attendance</th>
                <th>Assessments</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var student in Model.Students)
            {
                <tr>
                    <td>@(student.FamilyMember?.FirstName ?? "N/A") @(student.FamilyMember?.LastName ?? "N/A")</td>
                    <td>@student.Grade</td>
                    <td>@student.AcademicYear</td>
                    <td>@student.Status</td>
                    <td>
                        @if (Model.StudentAttendances.ContainsKey(student.Id) && Model.StudentAttendances[student.Id].Any())
                        {
                            <ul>
                                @foreach (var attendance in Model.StudentAttendances[student.Id].Take(3)) // Limit to 3 for brevity
                                {
                                    <li>@attendance.Date.ToString("yyyy-MM-dd"): @attendance.Status</li>
                                }
                            </ul>
                            if (Model.StudentAttendances[student.Id].Count > 3)
                            {
                                <small>(Showing first 3, total: @Model.StudentAttendances[student.Id].Count)</small>
                            }
                        }
                        else
                        {
                            <span>No attendance records.</span>
                        }
                    </td>
                    <td>
                        @if (Model.StudentAssessments.ContainsKey(student.Id) && Model.StudentAssessments[student.Id].Any())
                        {
                            <ul>
                                @foreach (var assessment in Model.StudentAssessments[student.Id].Take(3)) // Limit to 3 for brevity
                                {
                                    <li>@assessment.Name (@assessment.Date.ToString("yyyy-MM-dd")): @assessment.Marks/@assessment.TotalMarks (@assessment.Type)</li>
                                }
                            </ul>
                            if (Model.StudentAssessments[student.Id].Count > 3)
                            {
                                <small>(Showing first 3, total: @Model.StudentAssessments[student.Id].Count)</small>
                            }
                        }
                        else
                        {
                            <span>No assessment records.</span>
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No students found for your family.</p>
}